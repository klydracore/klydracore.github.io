<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KCGR Browser</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --muted:#6b7280; --accent:#2563eb;
    --glass: rgba(0,0,0,0.02);
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;}
  body{background:linear-gradient(180deg,#f0f4f9 0%,#e9eef5 100%);color:#111827;padding:18px;}
  .container{max-width:980px;margin:0 auto;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,0.1);}
  header{display:flex;gap:12px;align-items:center;margin-bottom:10px}
  header h1{font-size:18px;margin:0}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  input[type="text"]{background:var(--glass);border:1px solid rgba(0,0,0,0.1);color:#111827;padding:6px 8px;border-radius:6px;}
  button{background:transparent;border:1px solid rgba(0,0,0,0.1);color:#111827;padding:6px 8px;border-radius:6px;cursor:pointer}
  .repo-list{margin-top:12px}
  .node{padding:6px 8px;border-radius:6px;margin:4px 0;display:flex;gap:8px;align-items:center}
  .node:hover{background:rgba(0,0,0,0.03)}
  .toggle{cursor:pointer;user-select:none}
  .children{margin-left:22px;margin-top:6px;display:none}
  .children.open{display:block}
  .icon{width:20px;text-align:center;display:inline-block}
  .label{flex:1}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px}
  a.rawlink{color:inherit;text-decoration:none}
  .loading{font-style:italic;color:var(--muted);font-size:13px}
  .hint{margin-top:8px;color:var(--muted);font-size:13px}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div style="font-size:26px">üåê</div>
      <h1>KCGR Browser</h1>
      <div class="controls">
        <label class="small muted">Token (optional):</label>
        <input id="token" type="text" placeholder="ghp_.... (optional)" />
        <button id="refresh">Refresh</button>
      </div>
    </header>

    <div class="hint muted small">Click items to expand. Files go to raw URLs. Releases show assets.</div>
    <div id="status" class="muted small" style="margin-top:8px"></div>

    <div id="repoContainer" class="repo-list"></div>
  </div>

<script>
(() => {
  // multiple owners + icons
  const OWNERS = {
    "klydracore": "üì¶",
    "klydraproject": "üî¥",
    "swinglang": "üê¶"
  };

  const container = document.getElementById('repoContainer');
  const status = document.getElementById('status');
  const tokenInput = document.getElementById('token');
  const refreshBtn = document.getElementById('refresh');

  const ICONS = {
    repo: "üì¶",
    releases: "üì§",
    tag: "üè∑Ô∏è",
    branch: "üåø",
    folder: "üìÅ",
    file: "üìÉ",
    binary_pkg: "üì¶"
  };

  function apiHeaders() {
    const headers = { "Accept": "application/vnd.github.v3+json" };
    const token = tokenInput.value.trim();
    if (token) headers["Authorization"] = "token " + token;
    return headers;
  }

  function setStatus(text){
    status.textContent = text || "";
  }

  async function ghFetch(path) {
    const url = "https://api.github.com" + path;
    const res = await fetch(url, { headers: apiHeaders() });
    if (!res.ok) {
      let msg = res.statusText;
      try { const r = await res.json(); msg = r.message || msg; } catch{}
      throw new Error("GitHub API error: " + msg);
    }
    return res.json();
  }

  function makeNode(icon, label, opts = {}) {
    const node = document.createElement('div');
    node.className = "node";
    const toggle = document.createElement('span');
    toggle.className = "toggle icon";
    toggle.textContent = opts.expandable ? "‚ñ∫" : "";
    const ic = document.createElement('span'); ic.className = "icon"; ic.textContent = icon;
    const labelEl = document.createElement('div'); labelEl.className = "label";
    if (opts.href) {
      const a = document.createElement('a'); a.href = opts.href; a.className = "rawlink"; a.target = "_blank";
      a.rel = "noopener noreferrer"; a.textContent = label;
      labelEl.appendChild(a);
    } else {
      labelEl.textContent = label;
    }
    node.appendChild(toggle); node.appendChild(ic); node.appendChild(labelEl);
    if (opts.rightText) {
      const rt = document.createElement('div'); rt.className = "muted"; rt.textContent = opts.rightText; node.appendChild(rt);
    }
    if (opts.onClick) {
      node.style.cursor = "pointer";
      node.addEventListener('click', (e) => { e.stopPropagation(); opts.onClick(node, toggle); });
      toggle.addEventListener('click', (e)=>{ e.stopPropagation(); opts.onClick(node, toggle); });
    }
    return node;
  }

  async function loadOwner(owner, icon) {
    const ownerNode = makeNode(icon, owner, { expandable: true });
    container.appendChild(ownerNode);
    const ownerChildren = document.createElement('div'); ownerChildren.className = "children";
    ownerNode.insertAdjacentElement('afterend', ownerChildren);

    ownerNode.addEventListener('click', async (e) => {
      e.stopPropagation();
      if (ownerChildren.classList.contains('open')) {
        ownerChildren.classList.remove('open'); ownerNode.querySelector('.toggle').textContent = "‚ñ∫"; return;
      }
      ownerChildren.classList.add('open'); ownerNode.querySelector('.toggle').textContent = "‚ñº";
      ownerChildren.innerHTML = '<div class="loading">Loading repositories‚Ä¶</div>';
      try {
        const repos = await ghFetch(`/users/${owner}/repos?per_page=100&sort=updated`);
        ownerChildren.innerHTML = "";
        if (repos.length === 0) { ownerChildren.textContent = "No repositories."; return; }
        for (const repo of repos) {
          const repoNode = makeNode(ICONS.repo, repo.name, {
            expandable: true,
            rightText: repo.private ? "private" : "",
            onClick: async (n,t)=>{ /* same logic as your existing repo expansion */ }
          });
          ownerChildren.appendChild(repoNode);
        }
      } catch (err) {
        ownerChildren.innerHTML = '<div class="muted">Failed to load repositories.</div>';
        console.error(err);
      }
    });
  }

  async function loadAll() {
    container.innerHTML = "";
    setStatus("Loading owners‚Ä¶");
    for (const [owner,icon] of Object.entries(OWNERS)) {
      loadOwner(owner,icon);
    }
    setStatus("Click owners to expand.");
  }

  refreshBtn.addEventListener('click', loadAll);
  loadAll();
})();
</script>
</body>
</html>
